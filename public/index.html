<!DOCTYPE html>
<html>
<head>
  <title>UNO Online</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<h1>UNO Online</h1>

<input id="name" placeholder="Your name">
<input id="room" placeholder="Room code">
<button id="joinBtn" onclick="join()">Join Room</button>

<button id="startBtn" onclick="startGame()" style="display:none;">
  Start Game
</button>

<h3>Players:</h3>
<ul id="players"></ul>

<h3 id="turnStatus">Waitingâ€¦</h3>

<h3>Opponents</h3>
<div id="opponents" class="opponents"></div>

<h3>Discard Pile</h3>
<img id="discard" class="discard" src="assets/cards/uno_cover.png">

<h3>Your Cards</h3>
<div id="hand" class="hand"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let currentRoom = "";
let myId = "";
let isMyTurn = false;

// --------------------
function cardImage(card) {
  if (card.color === "wild") {
    return `assets/cards/${card.value}.png`;
  }
  return `assets/cards/${card.color}_${card.value}.png`;
}

// --------------------
socket.on("connect", () => {
  myId = socket.id;
});

// Alerts
socket.on("roomFull", () => alert("Room full"));
socket.on("alreadyJoined", () => alert("Already joined"));
socket.on("notEnoughPlayers", () => alert("Need at least 2 players"));
socket.on("gameAlreadyStarted", () => alert("Game already started"));

socket.on("playerList", (players) => {
  const ul = document.getElementById("players");
  ul.innerHTML = "";

  let amHost = false;

  players.forEach(p => {
    const li = document.createElement("li");
    li.innerText = p.name + (p.host ? " (Host)" : "");
    ul.appendChild(li);
    if (p.id === myId && p.host) amHost = true;
  });

  document.getElementById("startBtn").style.display =
    amHost ? "block" : "none";
});

socket.on("gameStarted", () => {
  document.getElementById("joinBtn").style.display = "none";
  document.getElementById("startBtn").style.display = "none";
});

socket.on("firstCard", (card) => {
  document.getElementById("discard").src = cardImage(card);
});

// TURN SYSTEM
socket.on("turnUpdate", ({ currentPlayerId }) => {
  if (currentPlayerId === myId) {
    isMyTurn = true;
    document.getElementById("turnStatus").innerText = "ðŸŸ¢ Your turn";
  } else {
    isMyTurn = false;
    document.getElementById("turnStatus").innerText = "â³ Opponentâ€™s turn";
  }
});

// PUBLIC GAME STATE (opponent cards)
socket.on("gameState", (state) => {
  const oppDiv = document.getElementById("opponents");
  oppDiv.innerHTML = "";

  state.players.forEach(p => {
    if (p.id === myId) return;

    const d = document.createElement("div");
    d.className = "opponent";
    d.innerHTML = `
      <div>${p.name}</div>
      <img src="assets/cards/uno_cover.png" width="60">
      <div>${p.handCount} cards</div>
    `;
    oppDiv.appendChild(d);
  });
});

// YOUR HAND
socket.on("yourHand", (hand) => {
  const handDiv = document.getElementById("hand");
  handDiv.innerHTML = "";

  hand.forEach(card => {
    const img = document.createElement("img");
    img.src = cardImage(card);
    img.className = "card";

    img.onclick = () => {
      if (!isMyTurn) {
        alert("Not your turn");
        return;
      }
      console.log("Play card:", card);
      // Step 13
    };

    handDiv.appendChild(img);
  });
});

// ACTIONS
function join() {
  const name = document.getElementById("name").value;
  const room = document.getElementById("room").value;
  if (!name || !room) return;

  currentRoom = room;
  socket.emit("joinRoom", room, name);
  document.getElementById("joinBtn").style.display = "none";
}

function startGame() {
  socket.emit("startGame", currentRoom);
}
</script>

</body>
</html>
